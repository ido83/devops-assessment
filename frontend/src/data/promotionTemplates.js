import { mkId } from '../utils/graphEngine';
function tpl(fn){const ids={};const mk=(k)=>{ids[k]=mkId();return ids[k];};return fn(mk,ids);}

export const PROMO_TEMPLATES = {
artifact_promotion:()=>tpl((mk,ids)=>({
  name:'Artifact Promotion',cat:'Standard',
  description:'Promote a build artifact through registry tiers (dev â†’ staging â†’ prod) with scanning and approval at each gate.',
  nodes:[
    {id:mk('s1'),label:'Build Artifact',type:'source',sub:'CI produces versioned image'},
    {id:mk('r1'),label:'Dev Registry',type:'registry',sub:'Push to dev namespace'},
    {id:mk('sc1'),label:'Security Scan',type:'scan',sub:'CVE + SBOM + license check'},
    {id:mk('v1'),label:'Verify Quality',type:'verify',sub:'Integration tests pass'},
    {id:mk('ap1'),label:'Approve Staging',type:'approve',sub:'Tech lead sign-off'},
    {id:mk('p1'),label:'Promote â†’ Staging',type:'promote',sub:'Copy image to staging registry'},
    {id:mk('r2'),label:'Staging Registry',type:'registry',sub:'staging namespace tag'},
    {id:mk('v2'),label:'Acceptance Tests',type:'verify',sub:'E2E + perf benchmarks'},
    {id:mk('ap2'),label:'Approve Prod',type:'approve',sub:'Release manager + product'},
    {id:mk('p2'),label:'Promote â†’ Prod',type:'promote',sub:'Copy image to prod registry'},
    {id:mk('n1'),label:'Notify Teams',type:'notify',sub:'Slack / Teams / email'},
  ],
  edges:[
    {from:ids.s1,to:ids.r1},{from:ids.r1,to:ids.sc1},{from:ids.sc1,to:ids.v1},
    {from:ids.v1,to:ids.ap1},{from:ids.ap1,to:ids.p1},{from:ids.p1,to:ids.r2},
    {from:ids.r2,to:ids.v2},{from:ids.v2,to:ids.ap2},{from:ids.ap2,to:ids.p2},
    {from:ids.p2,to:ids.n1},
  ],
})),
env_promotion:()=>tpl((mk,ids)=>({
  name:'Environment Promotion',cat:'Standard',
  description:'Move a release candidate across environments â€” dev â†’ QA â†’ staging â†’ production â€” with gates at each boundary.',
  nodes:[
    {id:mk('s1'),label:'Release Candidate',type:'source',sub:'Tagged commit / build'},
    {id:mk('p1'),label:'Deploy Dev',type:'promote',sub:'Auto-promote to dev env'},
    {id:mk('v1'),label:'Dev Smoke Tests',type:'verify',sub:'Sanity checks pass'},
    {id:mk('p2'),label:'Deploy QA',type:'promote',sub:'Promote to QA environment'},
    {id:mk('v2'),label:'QA Regression',type:'verify',sub:'Full regression suite'},
    {id:mk('ap1'),label:'QA Sign-Off',type:'approve',sub:'QA team approval'},
    {id:mk('p3'),label:'Deploy Staging',type:'promote',sub:'Promote to staging'},
    {id:mk('v3'),label:'Staging UAT',type:'verify',sub:'User acceptance tests'},
    {id:mk('ap2'),label:'Prod Approval',type:'approve',sub:'Stakeholder + CAB'},
    {id:mk('g1'),label:'Change Window',type:'gate',sub:'Scheduled deploy window'},
    {id:mk('p4'),label:'Deploy Production',type:'promote',sub:'Promote to prod'},
    {id:mk('n1'),label:'Release Notify',type:'notify',sub:'Announce to stakeholders'},
  ],
  edges:[
    {from:ids.s1,to:ids.p1},{from:ids.p1,to:ids.v1},{from:ids.v1,to:ids.p2},
    {from:ids.p2,to:ids.v2},{from:ids.v2,to:ids.ap1},{from:ids.ap1,to:ids.p3},
    {from:ids.p3,to:ids.v3},{from:ids.v3,to:ids.ap2},{from:ids.ap2,to:ids.g1},
    {from:ids.g1,to:ids.p4},{from:ids.p4,to:ids.n1},
  ],
})),
manual_gate:()=>tpl((mk,ids)=>({
  name:'Manual Approval Gate Flow',cat:'Standard',
  description:'Explicit human approval required at every promotion boundary. Suitable for regulated or high-risk deployments.',
  nodes:[
    {id:mk('s1'),label:'Candidate Ready',type:'source',sub:'Automated pipeline complete'},
    {id:mk('sc1'),label:'Compliance Scan',type:'scan',sub:'Policy + regulatory checks'},
    {id:mk('g1'),label:'Security Gate',type:'gate',sub:'Infosec approval required'},
    {id:mk('ap1'),label:'Dev Lead Approval',type:'approve',sub:'Code review sign-off'},
    {id:mk('p1'),label:'Promote Test',type:'promote',sub:'Push to test environment'},
    {id:mk('v1'),label:'Verify Tests',type:'verify',sub:'All test suites green'},
    {id:mk('ap2'),label:'Product Approval',type:'approve',sub:'PM / stakeholder sign-off'},
    {id:mk('ap3'),label:'CAB Approval',type:'approve',sub:'Change Advisory Board'},
    {id:mk('p2'),label:'Promote Prod',type:'promote',sub:'Controlled prod release'},
    {id:mk('n1'),label:'Audit Notify',type:'notify',sub:'Log to audit trail'},
  ],
  edges:[
    {from:ids.s1,to:ids.sc1},{from:ids.sc1,to:ids.g1},{from:ids.g1,to:ids.ap1},
    {from:ids.ap1,to:ids.p1},{from:ids.p1,to:ids.v1},{from:ids.v1,to:ids.ap2},
    {from:ids.ap2,to:ids.ap3},{from:ids.ap3,to:ids.p2},{from:ids.p2,to:ids.n1},
  ],
})),
feature_flag:()=>tpl((mk,ids)=>({
  name:'Feature Flag Promotion',cat:'Advanced',
  description:'Deploy dark (disabled) then gradually enable via feature flags. Decouple deployment from release. Instant kill-switch.',
  nodes:[
    {id:mk('s1'),label:'Build + Deploy Dark',type:'source',sub:'Feature flag OFF in prod'},
    {id:mk('v1'),label:'Dark Validation',type:'verify',sub:'Verify dark deploy healthy'},
    {id:mk('p1'),label:'Enable 1% Users',type:'promote',sub:'Flag: canary cohort'},
    {id:mk('sc1'),label:'Monitor Metrics',type:'scan',sub:'Error rate / perf / biz KPIs'},
    {id:mk('ap1'),label:'Approval to Scale',type:'approve',sub:'Data-driven review'},
    {id:mk('p2'),label:'Enable 10% â†’ 50%',type:'promote',sub:'Incremental rollout'},
    {id:mk('p3'),label:'Enable 100%',type:'promote',sub:'Full population'},
    {id:mk('rb1'),label:'Rollback (Flag Off)',type:'rollback',sub:'Instant disable if needed'},
    {id:mk('n1'),label:'Notify Complete',type:'notify',sub:'Feature fully live'},
  ],
  edges:[
    {from:ids.s1,to:ids.v1},{from:ids.v1,to:ids.p1},{from:ids.p1,to:ids.sc1},
    {from:ids.sc1,to:ids.ap1},{from:ids.ap1,to:ids.p2},{from:ids.p2,to:ids.p3},
    {from:ids.p3,to:ids.n1},{from:ids.sc1,to:ids.rb1},
  ],
})),
hotfix_promotion:()=>tpl((mk,ids)=>({
  name:'Hotfix Fast-Track Promotion',cat:'Advanced',
  description:'Emergency fix bypasses normal queue. Expedited scanning and approvals. Direct to prod with mandatory post-review.',
  nodes:[
    {id:mk('s1'),label:'Hotfix Branch',type:'source',sub:'Branch from prod tag'},
    {id:mk('sc1'),label:'Fast Scan',type:'scan',sub:'Targeted security + regression'},
    {id:mk('g1'),label:'Emergency Gate',type:'gate',sub:'On-call approver required'},
    {id:mk('ap1'),label:'Expedited Approval',type:'approve',sub:'VP Engineering or delegate'},
    {id:mk('p1'),label:'Deploy Hotfix Prod',type:'promote',sub:'Direct to production'},
    {id:mk('v1'),label:'Verify Fix',type:'verify',sub:'Confirm issue resolved'},
    {id:mk('n1'),label:'Incident Notify',type:'notify',sub:'Status page + stakeholders'},
    {id:mk('rb1'),label:'Rollback Ready',type:'rollback',sub:'Revert plan on standby'},
    {id:mk('ap2'),label:'Post-Mortem Review',type:'approve',sub:'Mandatory post-incident'},
  ],
  edges:[
    {from:ids.s1,to:ids.sc1},{from:ids.sc1,to:ids.g1},{from:ids.g1,to:ids.ap1},
    {from:ids.ap1,to:ids.p1},{from:ids.p1,to:ids.v1},{from:ids.v1,to:ids.n1},
    {from:ids.p1,to:ids.rb1},{from:ids.n1,to:ids.ap2},
  ],
})),
gitops_promotion:()=>tpl((mk,ids)=>({
  name:'GitOps Promotion Pipeline',cat:'Advanced',
  description:'Promotion via PR to environment-specific Git branches. ArgoCD/Flux syncs each environment from its branch automatically.',
  nodes:[
    {id:mk('s1'),label:'PR to dev branch',type:'source',sub:'Merge triggers dev sync'},
    {id:mk('p1'),label:'ArgoCD Sync Dev',type:'promote',sub:'Auto-reconcile dev cluster'},
    {id:mk('v1'),label:'Automated Tests',type:'verify',sub:'Post-sync test suite'},
    {id:mk('sc1'),label:'Policy Check',type:'scan',sub:'OPA / Kyverno gate'},
    {id:mk('ap1'),label:'PR to staging',type:'approve',sub:'Review + merge = promote'},
    {id:mk('p2'),label:'ArgoCD Sync Staging',type:'promote',sub:'Auto-reconcile staging'},
    {id:mk('v2'),label:'Staging Validation',type:'verify',sub:'E2E + security checks'},
    {id:mk('ap2'),label:'PR to main/prod',type:'approve',sub:'Release PR with CAB review'},
    {id:mk('p3'),label:'ArgoCD Sync Prod',type:'promote',sub:'Auto-reconcile production'},
    {id:mk('n1'),label:'Tag + Release',type:'notify',sub:'GitHub Release + changelog'},
  ],
  edges:[
    {from:ids.s1,to:ids.p1},{from:ids.p1,to:ids.v1},{from:ids.v1,to:ids.sc1},
    {from:ids.sc1,to:ids.ap1},{from:ids.ap1,to:ids.p2},{from:ids.p2,to:ids.v2},
    {from:ids.v2,to:ids.ap2},{from:ids.ap2,to:ids.p3},{from:ids.p3,to:ids.n1},
  ],
})),
semver_release:()=>tpl((mk,ids)=>({
  name:'SemVer Release Promotion',cat:'Standard',
  description:'Version bump (patch/minor/major) triggers automated release promotion. Changelog generation and registry tagging included.',
  nodes:[
    {id:mk('s1'),label:'Version Bump PR',type:'source',sub:'Conventional commits â†’ semver'},
    {id:mk('v1'),label:'Changelog Generate',type:'verify',sub:'Auto-generated from commits'},
    {id:mk('ap1'),label:'Release Approval',type:'approve',sub:'Maintainer approves bump'},
    {id:mk('sc1'),label:'Sign Artifact',type:'scan',sub:'Cosign / GPG signature'},
    {id:mk('r1'),label:'Tag Registry',type:'registry',sub:'Image tag: v1.2.3 + latest'},
    {id:mk('p1'),label:'Promote Stable',type:'promote',sub:'Mark as stable release'},
    {id:mk('n1'),label:'Publish Release',type:'notify',sub:'GitHub Release + Slack'},
    {id:mk('p2'),label:'Update Downstream',type:'promote',sub:'Notify dependent services'},
  ],
  edges:[
    {from:ids.s1,to:ids.v1},{from:ids.v1,to:ids.ap1},{from:ids.ap1,to:ids.sc1},
    {from:ids.sc1,to:ids.r1},{from:ids.r1,to:ids.p1},{from:ids.p1,to:ids.n1},
    {from:ids.n1,to:ids.p2},
  ],
})),
multi_region:()=>tpl((mk,ids)=>({
  name:'Multi-Region Staged Promotion',cat:'Advanced',
  description:'Roll out to regions sequentially. Monitor each region before proceeding. Automatic rollback on error threshold breach.',
  nodes:[
    {id:mk('s1'),label:'Release Package',type:'source',sub:'Validated + signed artifact'},
    {id:mk('ap1'),label:'Region 1 Approval',type:'approve',sub:'Region owner sign-off'},
    {id:mk('p1'),label:'Deploy Region 1',type:'promote',sub:'EU-West primary region'},
    {id:mk('v1'),label:'Monitor Region 1',type:'verify',sub:'30-min bake time + alerts'},
    {id:mk('rb1'),label:'Rollback R1',type:'rollback',sub:'Auto if error > 0.1%'},
    {id:mk('p2'),label:'Deploy Region 2',type:'promote',sub:'US-East region'},
    {id:mk('v2'),label:'Monitor Region 2',type:'verify',sub:'30-min bake time + alerts'},
    {id:mk('p3'),label:'Deploy Region 3',type:'promote',sub:'AP-South region'},
    {id:mk('n1'),label:'Global Release Done',type:'notify',sub:'All regions healthy'},
  ],
  edges:[
    {from:ids.s1,to:ids.ap1},{from:ids.ap1,to:ids.p1},{from:ids.p1,to:ids.v1},
    {from:ids.v1,to:ids.rb1},{from:ids.v1,to:ids.p2},{from:ids.p2,to:ids.v2},
    {from:ids.v2,to:ids.p3},{from:ids.p3,to:ids.n1},
  ],
})),
};

export const PROMO_NODE_COLORS = {
  source:  '#a29bfe',
  verify:  '#74b9ff',
  scan:    '#fd79a8',
  approve: '#e17055',
  promote: '#00cec9',
  notify:  '#ffd166',
  gate:    '#ff3b5c',
  rollback:'#ff8c42',
  registry:'#6c5ce7',
  custom:  '#636e72',
};
export const PROMO_NODE_ICONS = {
  source:  'ğŸ“¦',
  verify:  'âœ…',
  scan:    'ğŸ”',
  approve: 'ğŸ‘',
  promote: 'ğŸš€',
  notify:  'ğŸ””',
  gate:    'ğŸš§',
  rollback:'â†©ï¸',
  registry:'ğŸ—„ï¸',
  custom:  'âš™ï¸',
};

export const PROMO_TEMPLATE_LIST = [
  {key:'artifact_promotion', icon:'ğŸ“¦', cat:'Standard'},
  {key:'env_promotion',      icon:'ğŸŒ', cat:'Standard'},
  {key:'manual_gate',        icon:'ğŸš§', cat:'Standard'},
  {key:'semver_release',     icon:'ğŸ·ï¸', cat:'Standard'},
  {key:'feature_flag',       icon:'ğŸš©', cat:'Advanced'},
  {key:'hotfix_promotion',   icon:'ğŸ”¥', cat:'Advanced'},
  {key:'gitops_promotion',   icon:'â™¾ï¸', cat:'Advanced'},
  {key:'multi_region',       icon:'ğŸŒ', cat:'Advanced'},
];
